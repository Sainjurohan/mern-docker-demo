
- name: Update apt cache
  apt:
    update_cache: yes

- name: Install Python 3
  apt:
    name: python3
    state: present

- name: Install pip for Python 3
  apt:
    name: python3-pip
    state: present

- name: Clone MERN repo
  git:
    repo: https://github.com/Sainjurohan/mern-docker-demo.git
    dest: /home/{{ ansible_user }}/mern-docker-demo
    version: ansible
    force: yes

# adding debug
- name: Debug contents of project directory
  command: ls -la
  args:
    chdir: /home/{{ ansible_user }}/mern-docker-demo
  register: project_dir_contents

- name: Print project directory contents
  debug:
    var: project_dir_contents.stdout_lines


- name: Confirm docker-compose.yml exists
  stat:
    path: /home/{{ ansible_user }}/mern-docker-demo/docker-compose.yaml
  register: compose_file_check

- name: Print result of stat check
  debug:
    var: compose_file_check.stat.exists

# This is similar to the cloning the application to jenkins of server (remember not the local machine)
# - name: Copy Jenkinsfile to workspace (optional)
#   copy:
#     src: /home/{{ ansible_user }}/mern-docker-demo/Jenkinsfile
#     dest: /var/lib/jenkins/workspace/mern-project-pipeline/Jenkinsfile
#     remote_src: yes

# configuration to build the images and run containers
- name: Build Docker Images
  command: docker compose -f docker-compose.yaml build
  args:
    chdir: /home/{{ ansible_user }}/mern-docker-demo  # Change directory to where the docker-compose.yml is located

- name: Run Docker Containers
  command: docker compose -f docker-compose.yaml up -d
  args:
    chdir: /home/{{ ansible_user }}/mern-docker-demo

